@using Microsoft.AspNetCore.SignalR.Client
@using Microsoft.Extensions.Logging;

@using IoTAS.Shared.Hubs;

@inject NavigationManager NavigationManager;

@inject ILogger<MainFooter> Logger

@if (_hubConnection is null)
{
    footerText = "Link status unknown ...";
}
else
{
    footerText = $"Link status: {_hubConnection.State}";

    if (!string.IsNullOrWhiteSpace(_hubConnection.ConnectionId))
    {
        footerText += $" - ConnectionId: {_hubConnection.ConnectionId}";
    }
}

@footerText;


@code {

    private string footerText = string.Empty;

    private string exceptionMsg = string.Empty;

    private HubConnection _hubConnection;

    protected override void OnInitialized()
    {
        Logger.LogInformation($"{nameof(MainFooter)} initialized ...");

        var path = NavigationManager.ToAbsoluteUri(IMonitorHubServer.path);
        _hubConnection = new HubConnectionBuilder()
            .WithUrl(path)
            .Build();

        base.OnInitialized();
    }

}
